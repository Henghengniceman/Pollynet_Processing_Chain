function [wvconst, wvconstStd] = arielle_search_wvconst(currentTime, ...
                                file, deltaTime, defaults, flagUsePrevWVConst)
%arielle_search_wvconst Search the previous calibration constants with 
%a time lag less than deltaTime.
%   Example:
%       [wvconst, wvconstStd] = arielle_search_wvconst(currentTime, file,
%                                    deltaTime, defaults, flagUsePrevWVConst)
%   Inputs:
%       currentTime: datenum
%           current measurement time.
%       file: char
%           full path of the depol calibration file.
%       deltaTime: float
%           maximum time lag between the current time and the previous 
%           calibration time.
%       defaults: struct
%           defaults configuration. Detailed information can be found in 
%           doc/polly_defaults.md 
%       flagUsePrevWVConst: logical
%           flag to control whether to use previous calibration results.
%   Outputs:
%       wvconst: double
%           water vapor calibration constants.
%       wvconstStd: double
%           standard deviation of water vapor calibration constants.
%   History:
%       2019-02-26. First Edition by Zhenping
%       2019-08-16. Add 'flagUsePrevWVConst' to control whether to use previous
%                   calibration results.
%       2019-10-12. Enable using uncalibrated results if there is no calibrated
%                   results within the given time period.
%   Contact:
%       zhenping@tropos.de

if ~ exist('deltaTime', 'var')
    deltaTime = datenum(0, 1, 7);
end

if ~ exist('flagUsePrevWVConst', 'var')
    flagUsePrevWVConst = false;
end

[preWVCaliConst, preWVCaliConstStd] = ...
    load_wvconst(currentTime, file, pollyType, ...
                 'deltaTime', deltaTime, 'flagClosest', true);

if (~ flagUsePrevWVConst) || isempty(preWVconst)
    wvconst = defaults.wvconst;
    wvconstStd = defaults.wvconstStd;
else
    wvconst = preWVCaliConst;
    wvconstStd = preWVCaliConstStd;
end
    
end